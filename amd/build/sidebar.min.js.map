{"version":3,"file":"sidebar.min.js","sources":["../src/sidebar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript fast navigation interactive sidebar\n *\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n * @copyright 17/07/2020 Mfreak.nl | LdesignMedia.nl - Luuk Verhoeven\n * @author    Luuk Verhoeven\n **/\ndefine(['jquery', 'core/ajax', 'core/log', 'core/notification', 'core/templates', 'core/config', 'core_user/repository'],\n    function($, Ajax, Log, Notification, Templates, setUserPreference, UserRepository) {\n        'use strict';\n\n        var sidebar = {\n\n            options: {\n                open: false,\n                instanceid: 0\n            },\n\n            /**\n             * Set options base on listed options\n             * @param {object} options\n             */\n            setOptions: function(options) {\n                var key, vartype;\n                for (key in this.options) {\n                    if (this.options.hasOwnProperty(key) && options.hasOwnProperty(key)) {\n                        // Casting to prevent errors.\n                        vartype = typeof this.options[key];\n                        if (vartype === \"boolean\") {\n                            this.options[key] = Boolean(options[key]);\n                        } else if (vartype === 'number') {\n                            this.options[key] = Number(options[key]);\n                        } else if (vartype === 'string') {\n                            this.options[key] = String(options[key]);\n                        } else {\n                            this.options[key] = options[key];\n                        }\n                    }\n                }\n            },\n\n            /**\n             * Start\n             */\n            start: function() {\n                Log.debug('block_fastnav/sidebar: start()');\n                Log.debug(this.options);\n\n                // Load template.\n                this.loadNavigation();\n            },\n\n            /**\n             * Add sidebar\n             */\n            loadNavigation: function() {\n                var promises = Ajax.call([{\n                    methodname: 'block_fastnav_get_items',\n                    args: {\n                        instanceid: this.options.instanceid,\n                    }\n                }]);\n                promises[0].done(function(response) {\n\n                    if (response.items.length === 0) {\n                        Log.debug('block_fastnav/sidebar: no items.');\n                        return;\n                    }\n\n                    Templates.render('block_fastnav/block_item_list', response)\n                        .done(function(html) {\n                            $('body').prepend('<nav class=\"block-fastnav-sidebar\">' + html + '</nav>');\n                            sidebar.loadEvents();\n                        }).fail(Notification.exception);\n\n                }).fail(Notification.exception);\n            },\n\n            /**\n             * Open or close the fastnav sidebar\n             */\n            openOrClose: function() {\n\n                var $sidebar = $('.block-fastnav-sidebar');\n                if ($sidebar.width() !== 80) {\n                    $sidebar.animate({\n                        width: '80px',\n                    }, 300, function() {\n                        Log.debug('block_fastnav/sidebar: Animation complete.');\n                        $sidebar.find('.fa-arrow-left').removeClass('fa-arrow-left').addClass('fa-arrow-right');\n                    });\n                    return;\n                }\n\n                $sidebar.animate({\n                    width: 0,\n                }, 300, function() {\n                    Log.debug('block_fastnav/sidebar: Animation complete.');\n                    $sidebar.find('.fa-arrow-right').addClass('fa-arrow-left').removeClass('fa-arrow-right');\n                });\n            },\n\n            /**\n             * Check for some DOM events.\n             */\n            loadEvents: function() {\n                Log.debug('block_fastnav/sidebar: loadEvents()');\n\n                if ($('.block-fastnav-lock.active').length) {\n                    sidebar.openOrClose();\n                }\n\n                $('body').on('mouseover', '.block-fastnav-opener', function() {\n                    sidebar.openOrClose();\n                });\n\n                $('body').on('click', '.block-fastnav-lock', function(event) {\n\n                    // Check current status.\n                    var $el = $(event.currentTarget);\n                    var locked = $el.hasClass('active');\n                    Log.debug('block_fastnav/sidebar: locked ', locked);\n\n                    if (locked) {\n                        $el.removeClass('active');\n                        sidebar.updateOpenPreference('0');\n                        sidebar.openOrClose();\n                        return;\n                    }\n\n                    $el.addClass('active');\n                    sidebar.updateOpenPreference('1');\n                });\n\n                // Reload bootstrap tooltip.\n                try {\n                    $('.block-fastnav-sidebar a').tooltip();\n                } catch (e) {\n                    Log.debug('block_fastnav/sidebar: bootstrap tooltip not available ');\n                }\n            },\n\n            /**\n             *\n             * @param {string} status\n             */\n            updateOpenPreference: function(status) {\n                return UserRepository.setUserPreference(`block_fastnav_open`, status)\n                .catch(Notification.exception);\n            }\n        };\n\n        return {\n\n            /**\n             *\n             * @param {object} params\n             */\n            init: function(params) {\n                sidebar.setOptions(params);\n                sidebar.start();\n            }\n        };\n    });\n"],"names":["define","$","Ajax","Log","Notification","Templates","setUserPreference","UserRepository","sidebar","options","open","instanceid","setOptions","key","vartype","this","hasOwnProperty","Boolean","Number","String","start","debug","loadNavigation","call","methodname","args","done","response","items","length","render","html","prepend","loadEvents","fail","exception","openOrClose","$sidebar","width","animate","find","addClass","removeClass","on","event","$el","currentTarget","locked","hasClass","updateOpenPreference","tooltip","e","status","catch","init","params"],"mappings":";;;;;;;;AAuBAA,+BAAO,CAAC,SAAU,YAAa,WAAY,oBAAqB,iBAAkB,cAAe,yBAC7F,SAASC,EAAGC,KAAMC,IAAKC,aAAcC,UAAWC,kBAAmBC,oBAG3DC,QAAU,CAEVC,QAAS,CACLC,MAAM,EACNC,WAAY,GAOhBC,WAAY,SAASH,aACbI,IAAKC,YACJD,OAAOE,KAAKN,QACTM,KAAKN,QAAQO,eAAeH,MAAQJ,QAAQO,eAAeH,OAE3DC,eAAiBC,KAAKN,QAAQI,UAErBJ,QAAQI,KADD,YAAZC,QACoBG,QAAQR,QAAQI,MACjB,WAAZC,QACaI,OAAOT,QAAQI,MAChB,WAAZC,QACaK,OAAOV,QAAQI,MAEfJ,QAAQI,OAS5CO,MAAO,WACHjB,IAAIkB,MAAM,kCACVlB,IAAIkB,MAAMN,KAAKN,cAGVa,kBAMTA,eAAgB,WACGpB,KAAKqB,KAAK,CAAC,CACtBC,WAAY,0BACZC,KAAM,CACFd,WAAYI,KAAKN,QAAQE,eAGxB,GAAGe,MAAK,SAASC,UAEQ,IAA1BA,SAASC,MAAMC,OAKnBxB,UAAUyB,OAAO,gCAAiCH,UAC7CD,MAAK,SAASK,MACX9B,EAAE,QAAQ+B,QAAQ,sCAAwCD,KAAO,UACjEvB,QAAQyB,gBACTC,KAAK9B,aAAa+B,WARrBhC,IAAIkB,MAAM,uCAUfa,KAAK9B,aAAa+B,YAMzBC,YAAa,eAELC,SAAWpC,EAAE,0BACQ,KAArBoC,SAASC,QAUbD,SAASE,QAAQ,CACbD,MAAO,GACR,KAAK,WACJnC,IAAIkB,MAAM,8CACVgB,SAASG,KAAK,mBAAmBC,SAAS,iBAAiBC,YAAY,qBAbvEL,SAASE,QAAQ,CACbD,MAAO,QACR,KAAK,WACJnC,IAAIkB,MAAM,8CACVgB,SAASG,KAAK,kBAAkBE,YAAY,iBAAiBD,SAAS,sBAgBlFR,WAAY,WACR9B,IAAIkB,MAAM,uCAENpB,EAAE,8BAA8B4B,QAChCrB,QAAQ4B,cAGZnC,EAAE,QAAQ0C,GAAG,YAAa,yBAAyB,WAC/CnC,QAAQ4B,iBAGZnC,EAAE,QAAQ0C,GAAG,QAAS,uBAAuB,SAASC,WAG9CC,IAAM5C,EAAE2C,MAAME,eACdC,OAASF,IAAIG,SAAS,aAC1B7C,IAAIkB,MAAM,iCAAkC0B,QAExCA,cACAF,IAAIH,YAAY,UAChBlC,QAAQyC,qBAAqB,UAC7BzC,QAAQ4B,cAIZS,IAAIJ,SAAS,UACbjC,QAAQyC,qBAAqB,YAK7BhD,EAAE,4BAA4BiD,UAChC,MAAOC,GACLhD,IAAIkB,MAAM,6DAQlB4B,qBAAsB,SAASG,eACpB7C,eAAeD,uCAAwC8C,QAC7DC,MAAMjD,aAAa+B,mBAIrB,CAMHmB,KAAM,SAASC,QACX/C,QAAQI,WAAW2C,QACnB/C,QAAQY"}